<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta name="theme-color" content="#000" />
    <meta
      name="viewport"
      content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0"
    />
    <title>PLAYER</title>
    <link rel="icon" type="image/x-icon" href="/assets/favicon.png" />
    <link href="./output.css" rel="stylesheet" />
    <link
      rel="stylesheet"
      href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css"
      integrity="sha256-p4NxAoJBhIIN+hmNHrzRCf9tD/miZyoHS5obTRR9BMY="
      crossorigin=""
    />
    <script
      src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"
      integrity="sha256-20nQCchB9co0qIjJZRGuk2/Z9VM+kNiyxNV1lvTlZBo="
      crossorigin=""
    ></script>
  </head>
  <body class="h-screen bg-[#380448]">
    <div
      class="flex flex-col items-center justify-start w-full h-full p-5 pt-40 m-auto text-center game-container max-w-7xl"
    >
      <h1 class="absolute scale-75 select-none top-10" onclick="changeView(0)">
        o holy<br />
        <span class="text-[#d5d514]"
          >&nbsp;<span class="text-gray-300">quiz</span>night!</span
        >
      </h1>

      <!-- Buzzer  -->
      <div id="buzzer" class="flex flex-col justify-center hidden h-full">
        <!-- <input class="mb-5 bg-white" id="nameinput" type="text" /> -->
        <button
          class="bg-red-600 select-none active:bg-red-700 active:scale-90 active:border-5 active:text-yellow-500 -mt-32 text-xl text-white border-8 border-red-500 cursor-pointer rounded-[200px] w-64 h-64 play-button"
          onclick="onBuzzerClicked()"
        >
          Buzzer
        </button>
      </div>

      <!-- Player Info  -->
      <div
        id="player-info"
        class="absolute flex flex-col items-end justify-start text-xs opacity-50 top-3 right-3"
      >
        <!-- <input class="mb-5 bg-white" id="nameinput" type="text" /> -->
        <span id="player-info-name"></span>
        <span id="player-info-id" class="font-sans text-gray-600"></span>
      </div>

      <!-- Waiting Screen -->
      <div id="waiting-screen" class="hidden mt-20 text-3xl font-[Monotalic]">
        Please wait...
      </div>

      <!-- Login Screen -->
      <div id="login-screen" class="hidden mt-3 text-3xl">
        <h3>Wer bist du?</h3>
        <input
          placeholder="Dein Name..."
          id="player-name-input"
          type="text"
          maxlength="10"
          class="p-2 text-black bg-white rounded-lg"
        />
        <select
          id="team-selection"
          class="p-2 mt-5 text-black bg-white rounded-lg"
        >
          <option value="0">Team 1</option>
          <option value="1">Team 2</option>
          <option value="2">Team 3</option>
          <option value="3">Team 4</option>
        </select>
        <button
          id="login-button"
          class="w-full text-2xl text-black p-3 rounded-2xl bg-[#ce5bd3] mt-10 mb-10"
          onclick="onLoginButtonClicked()"
        >
          Einloggen
        </button>
      </div>

      <!-- Game #5 Umfragewerte -->
      <div id="game-umfragewerte" class="hidden font-[Monotalic]">
        <span
          id="game-umfragewerte-text"
          class="inline-block mt-20 mb-12 text-3xl"
          >Bist du ein Affe?</span
        >
        <button
          class="w-full p-5 mb-10 text-2xl bg-green-800 border-green-400 border-3 rounded-2xl"
          onclick="onAnswerButtonClicked(true)"
        >
          Ja
        </button>
        <button
          class="w-full p-5 text-2xl bg-red-900 border-red-400 border-3 rounded-2xl"
          onclick="onAnswerButtonClicked(false)"
        >
          Nein
        </button>
      </div>

      <!-- Game #9 MapFinder -->
      <div id="game-mapfinder" class="hidden font-[Monotalic] w-full">
        <span class="inline-block mb-8 text-3xl">MapFinder</span>
        <div id="map"></div>
        <button
          class="w-full text-2xl text-black p-3 rounded-2xl bg-[#ce5bd3] mt-10 mb-10"
          onclick="onAnswerButtonClicked()"
        >
          Absenden
        </button>
      </div>

      <!-- Game #12 TeamGuessing -->
      <div id="game-teamguessing" class="hidden font-[Monotalic] w-full">
        <span id="game-teamguessing-text" class="inline-block mb-8 text-3xl"
          >Wieviel wiegt ein Elefant?</span
        >
        <input
          type="number"
          placeholder="Enter your answer..."
          class="w-full text-5xl text-center text-black bg-white rounded-2xl"
          id="player-text-answer-input"
        />
        <button
          class="w-full text-2xl text-black p-3 rounded-2xl bg-[#ce5bd3] mt-10 mb-10"
          onclick="onAnswerButtonClicked(document.getElementById('player-text-answer-input').value)"
        >
          Absenden
        </button>
      </div>

      <!-- Game #13 Multiple Choice -->
      <div id="game-multiple-choice" class="hidden">
        <span id="game-multiple-choice-text" class="inline-block mb-12 text-3xl"
          >WER IST DER KING?</span
        >
        <button
          class="w-full p-5 mb-4 text-2xl text-left text-black bg-yellow-300 border-yellow-100 game-multiple-choice-answer border-3 rounded-2xl"
          onclick="onAnswerButtonClicked(0)"
        >
          A: Niemand
        </button>
        <button
          class="w-full p-5 mb-4 text-2xl text-left text-black bg-yellow-300 border-yellow-100 game-multiple-choice-answer border-3 rounded-2xl"
          onclick="onAnswerButtonClicked(1)"
        >
          B: Du
        </button>
        <button
          class="w-full p-5 mb-4 text-2xl text-left text-black bg-yellow-300 border-yellow-100 game-multiple-choice-answer border-3 rounded-2xl"
          onclick="onAnswerButtonClicked(2)"
        >
          C: Ich
        </button>
        <button
          class="w-full p-5 mb-4 text-2xl text-left text-black bg-yellow-300 border-yellow-100 game-multiple-choice-answer border-3 rounded-2xl"
          onclick="onAnswerButtonClicked(3)"
        >
          D: Deine Mudder
        </button>
      </div>

      <!-- Game #14 Creative Writing -->
      <div id="game-creative-writing" class="hidden font-[Monotalic] w-full">
        <div
          id="game-creative-writing-options"
          class="flex flex-col w-full space-y-2"
        >
          <label class="cursor-pointer">
            <input type="radio" name="word" class="hidden peer" />
            <span
              class="block px-4 py-2 border rounded-md peer-checked:ring-2 peer-checked:ring-yellow-400 peer-checked:bg-yellow-400 peer-checked:text-black"
            >
              Erdbeere
            </span>
          </label>

          <label class="cursor-pointer">
            <input type="radio" name="word" class="hidden peer" />
            <span
              class="block px-4 py-2 border rounded-md peer-checked:ring-2 peer-checked:ring-yellow-400 peer-checked:bg-yellow-400 peer-checked:text-black"
            >
              Banane
            </span>
          </label>

          <label class="cursor-pointer">
            <input type="radio" name="word" class="hidden peer" />
            <span
              class="block px-4 py-2 border rounded-md peer-checked:ring-2 peer-checked:ring-yellow-400 peer-checked:bg-yellow-400 peer-checked:text-black"
            >
              Kirsche
            </span>
          </label>

          <label class="cursor-pointer">
            <input type="radio" name="word" class="hidden peer" />
            <span
              class="block px-4 py-2 border rounded-md peer-checked:ring-2 peer-checked:ring-yellow-400 peer-checked:bg-yellow-400 peer-checked:text-black"
            >
              Kirsche
            </span>
          </label>
        </div>
        <button
          class="w-full text-2xl text-black p-3 rounded-2xl bg-[#ce5bd3] mt-10 mb-10"
          onclick="onAnswerButtonClicked()"
        >
          Absenden
        </button>
      </div>
    </div>

    <script src="/socket.io/socket.io.js"></script>
    <!-- <script type="text/javascript" src="racegame.js"></script> -->
    <script type="text/javascript" src="player.js"></script>
  </body>
  <style>
    #map {
      height: 400px;
      width: 100%;
      max-width: 600px;
    }
  </style>
  <script>
    var map;
    var marker;
    let markerLocation;

    function setMap() {
      // Map init
      map = L.map('map').setView([49.49, 11.11], 3);
      //   L.tileLayer(
      //     'https://tiles.basemaps.cartocdn.com/light_nolabels/{z}/{x}/{y}.png',
      //     {
      //       attribution: '',
      //     }
      //   ).addTo(map);
      L.tileLayer('https://tile.openstreetmap.org/{z}/{x}/{y}.png', {
        maxZoom: 7,
        attribution:
          '&copy; <a href="http://www.openstreetmap.org/copyright">OpenStreetMap</a>',
      }).addTo(map);
      //   L.tileLayer(
      //     'https://tiles.basemaps.cartocdn.com/light_nolabels/{z}/{x}/{y}.png',
      //     {
      //       attribution: '',
      //     }
      //   ).addTo(map);
      map.on('click', function (e) {
        if (marker) map.removeLayer(marker);
        markerLocation = e.latlng;

        console.log(e.latlng.lat, e.latlng.lng);
        //marker = new L.Marker(e.latlng, { draggable: true });
        // marker = new L.Marker(e.latlng, {
        //   icon: new L.DivIcon({
        //     className: 'my-div-icon',
        //     html: '<div class="text-amber-900">Titus</div>',
        //     // '<img class="my-div-image" src="http://png-3.vector.me/files/images/4/0/402272/aiga_air_transportation_bg_thumb"/>' +
        //     // '<span class="my-div-span">Titus</span>',
        //   }),
        // });
        marker = new L.Marker(e.latlng, { draggable: true });
        map.addLayer(marker);
      });

      setTimeout(() => {
        map.invalidateSize();
      }, 200);
    }

    setMap();

    function shuffleChildren(parent) {
      const children = Array.from(parent.children);

      // Fisher–Yates Shuffle
      for (let i = children.length - 1; i > 0; i--) {
        const j = Math.floor(Math.random() * (i + 1));
        [children[i], children[j]] = [children[j], children[i]];
      }

      // Neu anhängen (verschiebt die Elemente im DOM)
      children.forEach((child) => parent.appendChild(child));
    }

    function changeView() {
      let view = 'waiting-screen';
      switch (currentGame) {
        case 'game-kategorie':
        case 'game-whoisthis':
        case 'game-songs':
        case 'game-blamieren-kassieren':
          view = 'buzzer';
          break;
        case 'game-umfragewerte': {
          switch (currentGameState % 2) {
            case 1:
              view = currentGame;
              const question =
                quizData[currentGame].questions[
                  Math.floor(currentGameState / 2)
                ]?.question;
              console.log(quizData[currentGame], currentGameState);
              if (question) {
                document.getElementById('game-umfragewerte-text').textContent =
                  question;
              }
              break;
          }
          break;
        }
        case 'game-mapfinder': {
          switch (currentGameState % 5) {
            case 1:
              view = currentGame;
              break;
          }
          break;
        }
        case 'game-teamguessing': {
          let textInput1 = document.getElementById('player-text-answer-input');
          textInput1.type = 'number';
          let text = document.getElementById('game-teamguessing-text');
          switch (currentGameState % 5) {
            case 1:
              textInput1.value = '';
              let question =
                quizData[currentGame]?.questions[
                  Math.floor(currentGameState / 5)
                ]?.question;
              if (question) {
                text.innerHTML = question;
              }
              view = currentGame;
              break;
          }
          break;
        }
        case 'game-multiple-choice': {
          switch (currentGameState % 4) {
            case 2:
              let text = document.getElementById('game-multiple-choice-text');
              let answers = document.querySelectorAll(
                '.game-multiple-choice-answer'
              );
              let question =
                quizData[currentGame]?.questions[
                  Math.floor(currentGameState / 4)
                ];
              if (question) {
                text.innerHTML = question.question;
                answers.forEach((answerField, index) => {
                  answerField.innerHTML = question.answers[index];
                });
              }
              view = currentGame;
              break;
          }
          break;
        }
        case 'game-creative-writing': {
          document.getElementById('player-text-answer-input').type = 'text';
          let optionsField = document.getElementById(
            'game-creative-writing-options'
          );
          switch (currentGameState % 3) {
            case 1:
              let question =
                quizData[currentGame]?.questions[
                  Math.floor(currentGameState / 3)
                ];
              if (question) {
                document.getElementById('game-teamguessing-text').textContent =
                  question.question;
              }
              view = 'game-teamguessing';
              break;
            case 2:
              // Show PLayers Answers
              let optionsField = document.getElementById(
                'game-creative-writing-options'
              );
              optionsField.innerHTML = '';
              console.log('GAYMELOAD!!', game_payload);
              Array.isArray(game_payload) &&
                game_payload.forEach((team) => {
                  Object.values(team.members).forEach((member) => {
                    if (member.answer === '' || member.id === sock.id) return;
                    // <label class="cursor-pointer">
                    //   <input type="radio" name="word" class="hidden peer" />
                    //   <span class="block px-4 py-2 border rounded-md peer-checked:ring-2 peer-checked:ring-yellow-400 peer-checked:bg-yellow-400 peer-checked:text-black">
                    //     Erdbeere
                    //   </span>
                    // </label>;
                    let label = document.createElement('label');
                    label.className = 'cursor-pointer';
                    let input = document.createElement('input');
                    input.type = 'radio';
                    input.name = 'word';
                    input.className = 'hidden peer';
                    let span = document.createElement('span');
                    span.className =
                      'block px-4 py-2 border rounded-md peer-checked:ring-2 peer-checked:ring-yellow-400 peer-checked:bg-yellow-400 peer-checked:text-black;';
                    span.innerHTML = member.answer;
                    console.log(member.answer);
                    span.dataset.playerId = member.id;
                    label.appendChild(input);
                    label.appendChild(span);
                    optionsField.appendChild(label);
                  });
                });
              shuffleChildren(optionsField);
              view = 'game-creative-writing';
              break;
          }
          break;
        }
        case 'game-mitspieler': {
          let textInput = document.getElementById('player-text-answer-input');
          textInput.type = 'text';
          let textHeader = document.getElementById('game-teamguessing-text');
          switch (currentGameState % 2) {
            case 1:
              textInput.value = '';
              let question =
                quizData[currentGame]?.questions[
                  Math.floor(currentGameState / 2)
                ];
              if (question) {
                textHeader.innerHTML = question;
              }
              view = 'game-teamguessing';
              break;
          }
          break;
        }
        case 'login-screen':
          view = currentGame;
          break;
        default:
          view = 'waiting-screen';
          break;
      }
      document
        .querySelectorAll('.game-container > div')
        .forEach((elem) => elem.classList.add('hidden'));
      document.getElementById(view).classList.remove('hidden');
      document.getElementById('player-info').classList.remove('hidden');
      map.invalidateSize();
    }

    currentGame = 'login-screen';
    changeView();
  </script>
</html>
